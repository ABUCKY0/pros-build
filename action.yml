name: Pros Build
description: Automatically build pros projects

inputs:
  repository:
    description: Target repository
    required: false
    default: ${{ github.repository }}
  upload-built-template:
    required: false
    default: true

runs:
  using: composite
  steps:
    - name: Check if template
      id: template
      run: |
        template=$(awk -F'=' '/^IS_LIBRARY:=/{print $2}' Makefile)
        echo "template=$template" >> $GITHUB_OUTPUT
        echo template
      env:
        TEMPLATE: ${{ steps.template.outputs.template }}

    - name: Install ARM Toolchain
      uses: fiam/arm-none-eabi-gcc@v1
      with:
        release: "10-2020-q4"

    - name: Setup Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.9

    - name: PIP Installer
      uses: BSFishy/pip-action@v1
      with:
        packages: pros-cli

    - name: Testing PROS Install
      run: pros --version
      shell: bash

    - name: Checkout
      uses: actions/checkout@v4
      with:
        repository: ${{ inputs.repository }}
        path: ./pros-project

    - name: Build PROS Project
      run: |
        cd pros-project
        make clean quick -j
      shell: bash
